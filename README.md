# d4scraper

A few cron jobs which generate JSON files that can be served in an API. All timestamps are in UTC.

## Env
To run this script, you'll need access to an API that returns to you the last known boss spawn. There are a few out there, so just find one.
export D4_SCRAPE_API_URL="your-api-url"

## Crons
Set up these 3 crons. You can adjust the timing of your crons based on how aggressively you want to update. Its worth noting that D2 boss spawns are fairly accurate to predict if you have the right genesis information, so you don't need to refresh that often.

```
0 * * * * python3 /{path-to-project}/d4scraper/fetch_spawn_data.py
*/5 * * * * python3 /{path-to-project}/d4scraper/generate_windows.py
*/5 * * * * python3 /{path-to-project}/d4scraper/write_next_spawn.py
```

### fetch_spawn_data.py
`fetch_spawn_data.py` requests and caches api response of the last known boss spawn

### generate_windows.py
`generate_windows.py` will generate 20 spawn times, ensured to be within their windows. The bulk of the logic for determining spawn times lives in this file

### write_next_spawn.py
`write_next_spawn.py` writes the next spawn time to a file, using the windows generated with `generate_windows.py`

## Usage
The primary way to use these scripts is to write your own API (using flask or another framework) which reads the most recent files generated by `generate_windows.py` and `write_next_spawn.py` and just directly exposes their contents as an API. No need for further manipulation unless you want to.
